1. –û–±—â–∏–π –ø—Ä–∏–Ω—Ü–∏–ø

Runtime ‚Äî –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ª–æ–π.

–û–Ω:

–Ω–µ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ—Ç —Å–º—ã—Å–ª,

–Ω–µ –¥–µ–ª–∞–µ—Ç –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–π,

—Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç—Ä–æ–≥–æ –ø–æ canon.

2. Canon v2

–ò—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã:
canon/intents_v2.yml

–î–ª—è –∫–∞–∂–¥–æ–≥–æ intent –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ:–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è, –ø—Ä–∞–≤–∏–ª–∞ —É—Ç–æ—á–Ω–µ–Ω–∏—è, –ø—Ä–∞–≤–∏–ª–∞ disambiguation.

3. –û–¥–∏–Ω —É—Ç–æ—á–Ω—è—é—â–∏–π –≤–æ–ø—Ä–æ—Å

–ï—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ ‚Äî–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è:

ok = false

clarifying_question

–¢–æ–ª—å–∫–æ –æ–¥–∏–Ω –≤–æ–ø—Ä–æ—Å –∑–∞ —à–∞–≥.

4. Disambiguation

–ï—Å–ª–∏ ML –ø–µ—Ä–µ–¥–∞–ª:

—Å–ø–∏—Å–æ–∫ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤,

chosen_id –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç,

Runtime:

–Ω–µ –≤—ã–±–∏—Ä–∞–µ—Ç —Å–∞–º,

–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —É—Ç–æ—á–Ω—è—é—â–∏–π –≤–æ–ø—Ä–æ—Å,

–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç top candidates.

5. –°—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–µ —Å—É—â–Ω–æ—Å—Ç–∏

Runtime –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç:

cycles

goals

user_nudges

regulations

time_blocks

tasks

subtasks

6. –°—Ç–∞—Ç—É—Å—ã

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ:

WAITING

PAUSED

IN_PROGRESS

DONE

WAITING –∏ PAUSED –Ω–µ –≤–∑–∞–∏–º–æ–∑–∞–º–µ–Ω—è–µ–º—ã.

7. –û—Ç–≤–µ—Ç Runtime
–£—Å–ø–µ—Ö
ok = true
user_message

–£—Ç–æ—á–Ω–µ–Ω–∏–µ
ok = false
clarifying_question
choices (–µ—Å–ª–∏ –µ—Å—Ç—å)

---

# STRATEGIC LAYER CANON v1 (cycles / goals / nudges)

–≠—Ç–æ—Ç —Å–ª–æ–π –Ω—É–∂–µ–Ω –Ω–µ –¥–ª—è ‚Äú–µ—â—ë –æ–¥–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ –∑–∞–¥–∞—á‚Äù, –∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω—á–µ—Å–∫–æ–π –∫–∞—Ä—Ç–∏–Ω—ã:
- –µ—Å—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞ —Å–æ —Å—Ä–æ–∫–∞–º–∏,
- –µ—Å—Ç—å —Ñ–∞–∫—Ç –ø–æ–ø–∞–¥–∞–Ω–∏—è/–Ω–µ–ø–æ–ø–∞–¥–∞–Ω–∏—è –≤ —Å—Ä–æ–∫,
- –µ—Å—Ç—å –∏—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–Ω–æ—Å–æ–≤,
- –µ—Å—Ç—å —Å–≤–æ–¥–∫–∞ –ø–æ –ø–µ—Ä–∏–æ–¥—É (—Ü–∏–∫–ª—É).

–í–∞–∂–Ω–æ: runtime –Ω–µ ‚Äú–¥–∞–≤–∏—Ç‚Äù –∏ –Ω–µ –∑–∞–ø—Ä–µ—â–∞–µ—Ç. –û–Ω –¥–µ–ª–∞–µ—Ç –≤–∏–¥–∏–º—ã–º –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ.

---

## 1) Cycle ‚Äî —Ä–∞–º–∫–∞ –∞–Ω–∞–ª–∏–∑–∞ –ø–µ—Ä–∏–æ–¥–∞

### –°–º—ã—Å–ª (—á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏)
–¶–∏–∫–ª ‚Äî —ç—Ç–æ –ø–µ—Ä–∏–æ–¥, –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É —Ç—ã —Ö–æ—á–µ—à—å —É–≤–∏–¥–µ—Ç—å –∏—Ç–æ–≥:
—á—Ç–æ —É–¥–∞–ª–æ—Å—å, —á—Ç–æ –Ω–µ—Ç, –≥–¥–µ —Å–æ—Ä–≤–∞–ª—Å—è —Å—Ä–æ–∫, –≥–¥–µ –ø–µ—Ä–µ–Ω–æ—Å–∏–ª.

–¶–∏–∫–ª –Ω–µ –∑–∞–¥–∞—ë—Ç –ø—Ä–æ—Å—Ä–æ—á–∫—É. –ü—Ä–æ—Å—Ä–æ—á–∫—É –∑–∞–¥–∞—ë—Ç —Å—Ä–æ–∫ —Ü–µ–ª–∏.

### –ü—Ä–∞–≤–∏–ª–∞
- –¶–∏–∫–ª –º–æ–∂–Ω–æ –∑–∞–∫—Ä—ã—Ç—å –≤ –ª—é–±–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ (–¥–∞–∂–µ –µ—Å–ª–∏ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ —Ü–µ–ª–∏).
- –ü—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Ü–∏–∫–ª –≤—Å–µ–≥–¥–∞ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç —Å–≤–æ–¥–∫—É.
- –ó–∞–∫—Ä—ã—Ç–∏–µ —Ü–∏–∫–ª–∞ ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω—á–µ—Å–∫–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ, –Ω–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∫–∞.

### Intents
- `cycle.create`
  - required: `name`, `start_date`, `end_date`
  - one question (–µ—Å–ª–∏ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç): ‚Äú–ö–∞–∫ –Ω–∞–∑–≤–∞—Ç—å —Ü–∏–∫–ª?‚Äù / ‚Äú–î–æ –∫–∞–∫–æ–≥–æ —á–∏—Å–ª–∞ –æ–Ω –¥–ª–∏—Ç—Å—è?‚Äù
- `cycle.close`
  - required: `cycle_id`
  - —Ä–µ–∑—É–ª—å—Ç–∞—Ç: —Å–≤–æ–¥–∫–∞ –ø–æ —Ü–∏–∫–ª—É (—Å–º. –Ω–∏–∂–µ)

> –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: `cycle.activate` –æ–ø—Ü–∏–æ–Ω–∞–ª–µ–Ω. –í v1 –º–æ–∂–Ω–æ —Å—á–∏—Ç–∞—Ç—å ‚Äú—Ç–µ–∫—É—â–∏–π –∞–∫—Ç–∏–≤–Ω—ã–π —Ü–∏–∫–ª‚Äù –≤—ã–±—Ä–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º/–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º.

---

## 2) Goal ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ —Å–æ —Å—Ä–æ–∫–æ–º

### –°–º—ã—Å–ª (—á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏)
–¶–µ–ª—å ‚Äî —ç—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –∫–æ—Ç–æ—Ä—ã–π —Ç—ã –±–µ—Ä—ë—à—å—Å—è —Å–¥–µ–ª–∞—Ç—å –∫ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π –¥–∞—Ç–µ.
–¶–µ–Ω–Ω–æ—Å—Ç—å –Ω–µ —Ç–æ–ª—å–∫–æ ‚Äú—Å–¥–µ–ª–∞–ª/–Ω–µ —Å–¥–µ–ª–∞–ª‚Äù, –Ω–æ –∏ ‚Äú–≤ —Å—Ä–æ–∫/–Ω–µ –≤ —Å—Ä–æ–∫‚Äù –∏ ‚Äú—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –ø–µ—Ä–µ–Ω–æ—Å–∏–ª‚Äù.

### –ü–æ–ª—è (–º–∏–Ω–∏–º—É–º)
- `title`
- `success_criteria` (—Ç–µ–∫—Å—Ç, –∫–∞–∫ –ø–æ–Ω—è—Ç—å —á—Ç–æ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–æ)
- `planned_end_date` (—Å—Ä–æ–∫ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞)
- `status`: `ACTIVE | DONE | DROPPED`
- `completed_at` (–µ—Å–ª–∏ DONE)
- `reschedule_events[]` (–∏—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–Ω–æ—Å–æ–≤)

### –ü—Ä–∞–≤–∏–ª–∞
- –ü—Ä–æ—Å—Ä–æ—á–∫–∞ –Ω–µ –º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å. –¶–µ–ª—å –æ—Å—Ç–∞—ë—Ç—Å—è `ACTIVE`.
- –ü—Ä–æ—Å—Ä–æ—á–∫–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è –ø–æ `planned_end_date` (–Ω–µ –ø–æ —Ü–∏–∫–ª—É).
- –ü–µ—Ä–µ–Ω–æ—Å —Å—Ä–æ–∫–∞ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ —Å–æ–±—ã—Ç–∏–µ (–∏—Å—Ç–æ—Ä–∏—è –Ω–µ —Å—Ç–∏—Ä–∞–µ—Ç—Å—è).

### Intents
- `goal.create`
  - required: `title`, `success_criteria`, `planned_end_date`
  - optional: `cycle_id` (–µ—Å–ª–∏ –Ω–µ—Ç ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —Ü–∏–∫–ª)
  - one question:
    - –µ—Å–ª–∏ –Ω–µ—Ç —Ü–∏–∫–ª–∞: ‚Äú–í –∫–∞–∫–æ–º —Ü–∏–∫–ª–µ —Å–æ–∑–¥–∞—Ç—å —Ü–µ–ª—å?‚Äù
    - –µ—Å–ª–∏ –Ω–µ—Ç –∫—Ä–∏—Ç–µ—Ä–∏—è: ‚Äú–ö–∞–∫ –ø–æ–Ω—è—Ç—å, —á—Ç–æ —Ü–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞?‚Äù
    - –µ—Å–ª–∏ –Ω–µ—Ç —Å—Ä–æ–∫–∞: ‚Äú–ö –∫–∞–∫–æ–º—É —á–∏—Å–ª—É –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç?‚Äù
- `goal.update`
  - required: `goal_id`
  - requires at least one of: `title`, `success_criteria`, `status`
  - one question: ‚Äú–ß—Ç–æ –∏–º–µ–Ω–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –≤ —Ü–µ–ª–∏?‚Äù
- `goal.close`
  - required: `goal_id`
  - optional: `status` (`DONE` –∏–ª–∏ `DROPPED`)
  - one question: ‚Äú–ó–∞–∫—Ä—ã—Ç—å –∫–∞–∫ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç—É—é –∏–ª–∏ –∫–∞–∫ —Å–Ω—è—Ç—É—é?‚Äù
- `goal.reschedule`
  - required: `goal_id`, `new_end_date`
  - side effects:
    - create reschedule event `{old_end_date, new_end_date, changed_at}`
  - one question: ‚Äú–ö –∫–∞–∫–æ–º—É —á–∏—Å–ª—É –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ —Å—Ä–æ–∫?‚Äù

---

## 3) Nudges ‚Äî —Å–∏–≥–Ω–∞–ª—ã –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–π

### –°–º—ã—Å–ª (—á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏)
Nudge ‚Äî —ç—Ç–æ ‚Äú–∫—Ä–∞—Å–Ω—ã–π —Ñ–ª–∞–∂–æ–∫‚Äù: —Å–∏—Å—Ç–µ–º–∞ –Ω–µ —Ä—É–≥–∞–µ—Ç, –∞ –¥–µ–ª–∞–µ—Ç –≤–∏–¥–∏–º—ã–º —Ç–æ, —á—Ç–æ –∏–Ω–∞—á–µ –ª–µ–≥–∫–æ —Å–ø—Ä—è—Ç–∞—Ç—å –≤ –ø–æ—Ç–æ–∫–µ.

### –ü—Ä–∏–Ω—Ü–∏–ø—ã
- Nudge —Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
- Nudge –Ω–µ —É–¥–∞–ª—è–µ—Ç—Å—è ‚Äú–ø–æ –∂–µ–ª–∞–Ω–∏—é‚Äù.
- Nudge –º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å (ack) ‚Äî ‚Äú—è —É–≤–∏–¥–µ–ª‚Äù.

### Nudges v1 (–º–∏–Ω–∏–º—É–º)
- `goal.overdue` (–ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π)
  - condition: `goal.status == ACTIVE` and `today > planned_end_date`
  - persists until: goal is DONE/DROPPED OR goal is rescheduled
- `goal.multiple_reschedules` (–ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π)
  - condition: reschedule_count >= N (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é N=3, –ø–æ–∑–∂–µ ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∞)
  - persists until: —Ü–µ–ª—å –∑–∞–∫—Ä—ã—Ç–∞ –∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç/–ø–µ—Ä–µ–æ—Ñ–æ—Ä–º–ª—è–µ—Ç —Ü–µ–ª—å –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ
- `cycle.summary` (—Å–æ–±—ã—Ç–∏–µ –Ω–∞ –∑–∞–∫—Ä—ã—Ç–∏–µ —Ü–∏–∫–ª–∞)
  - condition: cycle close
  - content:
    - total goals
    - done in time
    - done with reschedules
    - overdue active
    - average reschedules

### Intents
- `nudge.list`
  - required: none
- `nudge.ack`
  - required: `nudge_id`
  - one question: ‚Äú–ö–∞–∫–æ–π —Å–∏–≥–Ω–∞–ª –æ—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–π?‚Äù

---

## 4) –ó–∞–∫—Ä—ã—Ç–∏–µ —Ü–∏–∫–ª–∞: —á—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç runtime

–ü—Ä–∏ `cycle.close` runtime –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–≤–æ–¥–∫—É (—á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏–º —Ç–µ–∫—Å—Ç–æ–º) –∏ –ø–æ–ª—è –¥–ª—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:

- `goals_total`
- `goals_done_in_time`
- `goals_done_with_reschedules`
- `goals_overdue_active`
- `avg_reschedules_per_goal`

–í–∞–∂–Ω–æ: –∑–∞–∫—Ä—ã—Ç–∏–µ —Ü–∏–∫–ª–∞ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –∏–∑-–∑–∞ –æ–¥–Ω–æ–π/–Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö —Ü–µ–ª–µ–π.
–ü–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è —Ü–∏–∫–ª–∞ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ —Ü–µ–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è ACTIVE, –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–µ—à–∞–µ—Ç:
- –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ —Å—Ä–æ–∫,
- –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ –≤ –Ω–æ–≤—ã–π —Ü–∏–∫–ª,
- —Å–Ω—è—Ç—å (DROPPED),
- –∑–∞–∫—Ä—ã—Ç—å –∫–∞–∫ DONE, –µ—Å–ª–∏ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞.

---

## 5) Daily Digest (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π)

Intent: `digest.daily`

Runtime —Å—á–∏—Ç–∞–µ—Ç –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç:

- `goals_active`
- `goals_overdue`
- `goals_due_soon`
- `goals_at_risk`
- `tasks_today`
- `tasks_tomorrow`
- `tasks_active_total`

–°–ø–∏—Å–æ—á–Ω—ã–µ intents –¥–ª—è UX:

- `goals.list_overdue`
- `goals.list_due_soon`
- `goals.list_at_risk`
- `tasks.list_today`
- `tasks.list_tomorrow`
- `tasks.list_active`

–í–∞–∂–Ω–æ: runtime –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ —Å–ø–∏—Å–∫–∏ –∏–∑ –ë–î, UX —Ç–æ–ª—å–∫–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç.

---

## VPS Thin-Runtime Model

- VPS —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ thin-runtime.
- ML-–ª–æ–≥–∏–∫–∞ –≤—ã–Ω–µ—Å–µ–Ω–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤ –ª–æ–∫–∞–ª—å–Ω—ã–π ML-Gateway.
- –ù–∞ VPS –≤ –ø—Ä–æ–¥-–∫–æ–Ω—Ç—É—Ä–µ –Ω–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ `asr-service`.
- –î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ ML –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è reverse tunnel:
- `127.0.0.1:19000` (VPS) -> `127.0.0.1:9000` (local ML host).
- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –æ–±—Ä–∞—â–∞—é—Ç—Å—è –∫ ML —á–µ—Ä–µ–∑:
- `ML_CORE_URL=http://host.docker.internal:19000`
- `telegram-bot` –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç `asr-service`.
- –î–ª—è VPS-—Ä–µ–∂–∏–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è compose override —Å networking-–ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏.

## Production DB Architecture (final)

- –û–¥–∏–Ω runtime DB backend: SQLite.
- `DB_PATH=/data/organizer.db` –¥–ª—è `organizer-worker`, `organizer-api`, `telegram-bot`.
- Named volume –≤ compose: `db_data`.
- –§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∏–º—è Docker volume –ø—Ä–∏ –ø—Ä–æ–µ–∫—Ç–µ `deploy`: `deploy_db_data`.
- `organizer-worker` –∏ `organizer-api` –æ–±—è–∑–∞–Ω—ã —Å–º–æ—Ç—Ä–µ—Ç—å –≤ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ `/data`.

## Migration Safety (mandatory)

- –ü–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏—è–º–∏ –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ü–µ–ª–µ–≤–æ–π volume: `deploy_db_data`.
- –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –∏–Ω—Ü–∏–¥–µ–Ω—Ç split-brain: –º–∏–≥—Ä–∞—Ü–∏–∏ –±—ã–ª–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –≤ –¥—Ä—É–≥–æ–π volume (`deploy_runtime_data`), –∏–∑-–∑–∞ —á–µ–≥–æ runtime –≤–∏–¥–µ–ª —Å—Ö–µ–º—É –±–µ–∑ `tasks`.
- –ë–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ volume –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—Ç—å –Ω–µ–ª—å–∑—è.
- –ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–π –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—Ç—å –Ω–∞–ª–∏—á–∏–µ `tasks` –≤ `/data/organizer.db`.

## Worker Startup Invariant

- –ù–∞ —Å—Ç–∞—Ä—Ç–µ worker –ª–æ–≥–∏—Ä—É–µ—Ç DB sanity: `DB_PATH`, `tables_count`, `required_tables`.
- Required tables:
- `tasks`
- `subtasks`
- `time_blocks`
- `cycles`
- `goals`
- `regulation_runs`

## ASR in Production

- ASR-—Å–µ—Ä–≤–∏—Å –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∫—Ä–∏—Ç–∏—á–Ω–æ–π —á–∞—Å—Ç—å—é VPS runtime.
- –í –ø—Ä–æ–¥-–∫–æ–Ω—Ç—É—Ä–µ ASR —Å—á–∏—Ç–∞–µ—Ç—Å—è optional/profile-based –∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç–∫–ª—é—á—ë–Ω.

## Production Deploy Baseline

- Production branch: `runtime-stable` only.
- –ü–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º VPS-–¥–µ—Ä–µ–≤–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å clean (`git status --porcelain` –ø—É—Å—Ç–æ).
- –ë–∞–∑–æ–≤—ã–π –ø–æ—Ç–æ–∫: local commit/push -> VPS `git pull --ff-only` -> `docker compose ... up -d --build`.
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ mounts:
- `organizer-worker`: `./canon:/canon:ro`, `./migrations:/app/migrations:ro`
- `telegram-bot`: `./canon:/canon:ro`
- `GOOGLE_CALENDAR_ID` –±–µ—Ä—ë—Ç—Å—è —Ç–æ–ª—å–∫–æ –∏–∑ `.env.prod`; —Ö–∞—Ä–¥–∫–æ–¥ `primary` –∑–∞–ø—Ä–µ—â—ë–Ω –¥–ª—è service account.
- `GOOGLE_SERVICE_ACCOUNT_FILE=/data/google_sa.json`.
- –ü–æ–¥—Ä–æ–±–Ω—ã–π runbook –∏ troubleshooting: `docs/HANDOFF.md`.

---

## 6) –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö (Runtime)

### –°—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–π —Å–ª–æ–π
- `cycles` ‚Äî –ø–µ—Ä–∏–æ–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è.
- `goals` ‚Äî —Ü–µ–ª–∏ —Ü–∏–∫–ª–∞ (`ACTIVE | DONE | DROPPED`) —Å `planned_end_date`.
- `goal_reschedule_events` ‚Äî –Ω–µ–∏–∑–º–µ–Ω—è–µ–º–∞—è –∏—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–Ω–æ—Å–æ–≤.
- `nudge_ack` / `user_nudges` ‚Äî —Å–∏–≥–Ω–∞–ª—ã –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞.

### –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Å–ª–æ–π
- `tasks` ‚Äî –∑–∞–¥–∞—á–∏ (—Å—Ç–∞—Ç—É—Å, –ø–ª–∞–Ω–æ–≤–∞—è –¥–∞—Ç–∞, —Å–≤—è–∑–∏).
- `subtasks` ‚Äî –ø–æ–¥–∑–∞–¥–∞—á–∏.
- `time_blocks` ‚Äî –±–ª–æ–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –∑–∞–¥–∞—á.

### –°–≤—è–∑–∏
- `tasks.goal_id -> goals.id`
- `goals.cycle_id -> cycles.id`

–ü—Ä–∏–Ω—Ü–∏–ø: —Ñ–∞–∫—Ç—ã –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏ –∑–Ω–∞—á–∏–º—ã–º –æ–±—Ä–∞–∑–æ–º; –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–æ–≤ –∏ —Å–∏–≥–Ω–∞–ª–æ–≤ –≤–µ–¥—ë—Ç—Å—è —è–≤–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è.

---

## 7) Telegram UX Copybook (RU, management tone)

–ù–∏–∂–µ ‚Äî –∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–µ —Ñ—Ä–∞–∑—ã –¥–ª—è daily digest –∏ –µ–≥–æ –¥–µ–π—Å—Ç–≤–∏–π.
–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏ –¥–æ—Å–ª–æ–≤–Ω–æ.

### Digest header
- `–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —É–ø—Ä–∞–≤–ª–µ–Ω—á–µ—Å–∫–∞—è —Å–≤–æ–¥–∫–∞`

### Digest lines
- `–ê–∫—Ç–∏–≤–Ω—ã–µ —Ü–µ–ª–∏: {value}`
- `–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ —Ü–µ–ª–∏: {value}`
- `–¶–µ–ª–∏ —Å–æ —Å—Ä–æ–∫–æ–º —Å–µ–≥–æ–¥–Ω—è/–∑–∞–≤—Ç—Ä–∞: {value}`
- `–¶–µ–ª–∏ –ø–æ–¥ —Ä–∏—Å–∫–æ–º: {value}`
- `–ó–∞–¥–∞—á–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è: {value}`
- `–ó–∞–¥–∞—á–∏ –Ω–∞ –∑–∞–≤—Ç—Ä–∞: {value}`
- `–ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏: {value}`

### Buttons (digest entry)
- `‚ö†Ô∏è –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ`
- `‚è≥ –ò—Å—Ç–µ–∫–∞—é—Ç`
- `üü† –ü–æ–¥ —Ä–∏—Å–∫–æ–º`
- `üìå –°–µ–≥–æ–¥–Ω—è`
- `üìå –ó–∞–≤—Ç—Ä–∞`
- `üìã –í—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏`

### List states
- `–°–ø–∏—Å–æ–∫ –ø—É—Å—Ç.`
- `... –∏ –µ—â—ë {value}`

### Goal item text
- `{index}. #{goal_id} {title} ‚Äî –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–∞ –Ω–∞ {days}–¥, –ø–µ—Ä–µ–Ω–æ—Å–æ–≤: {reschedule_count}`
- `{index}. #{goal_id} {title} ‚Äî –¥–æ —Å—Ä–æ–∫–∞ {days}–¥, –ø–µ—Ä–µ–Ω–æ—Å–æ–≤: {reschedule_count}`

### Goal actions
- `‚è≠ –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ +7–¥`
- `‚úÖ –ó–∞–∫—Ä—ã—Ç—å`
- `üóë –°–Ω—è—Ç—å`

### Task actions
- `‚ñ∂Ô∏è –í —Ä–∞–±–æ—Ç—É`
- `‚è∏ –ü–∞—É–∑–∞`
- `‚úÖ –ó–∞–≤–µ—Ä—à–∏—Ç—å`
- `‚è± –í—Ä–µ–º—è`

### Action results
- `–ö–æ–º–∞–Ω–¥–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞.`
- `–ö–æ–º–∞–Ω–¥–∞ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞.`

–ó–∞–ø—Ä–µ—â–µ–Ω—ã —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∏ –æ—Ü–µ–Ω–æ—á–Ω—ã–µ —Ä–µ–ø–ª–∏–∫–∏ –≤ digest-—Å—Ü–µ–Ω–∞—Ä–∏–∏.
